{"version":3,"sources":["OTP.js"],"names":["mongoose","require","mailSender","OTPSchema","Schema","type","String","required","Date","default","now","createdAt","sendVerificationEmail","email","otp","mailResponse","regeneratorRuntime","async","_context","prev","next","awrap","concat","sent","abrupt","t0","console","log","stop","pre","_context2","this","module","exports","model"],"mappings":"aAAA,IAAMA,SAAWC,QAAQ,YACnBC,WAAaD,QAAQ,uBAErBE,UAAY,IAAIH,SAASI,OAAO,CAFhCF,MAAAA,CAIEG,KAAMC,OAFRH,UAAY,GAEVE,IAAI,CACJE,KAAUD,OAHoBC,UAAA,GAM9BF,UAAMC,CACNC,KAAUC,KAPoBC,QAAAD,KAAAE,IASlCC,QAAW,OAAA,SAAAC,sBAAAC,EAAAC,GAAA,IAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAAAJ,mBAAAK,MAUoBnB,WAFpBU,EAAf,sCAE6C,mFAAAU,OAF7CR,EAE6C,8DAV9B,KAAA,EAAA,OAUDC,EAVCG,EAAAK,KAAAL,EAAAM,OAAA,SAQfT,GARe,KAAA,EAAA,MAAAG,EAAAC,KAAA,EAAAD,EAAAO,GAAAP,EAAA,MAAA,GAQfQ,QAAAC,IAAA,mDAAAT,EAAAO,IAReP,EAAAO,GAAA,KAAA,GAAA,IAAA,MAAA,OAAAP,EAAAU,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,KAQfzB,UAAA0B,IAAA,OAAA,SAAAT,GAAA,OAAAJ,mBAAAC,MAAA,SAAAa,GAAA,OAAA,OAAAA,EAAAX,KAAAW,EAAAV,MAAA,KAAA,EAAA,OAAAU,EAAAX,KAAA,EAAAW,EAAAV,KAAA,EAAAJ,mBAAAK,MAAAT,sBAAAmB,KAAAlB,MAAAkB,KAAAjB,MAAA,KAAA,EAWQY,IAXRI,EAAAV,KAAA,EAAA,MAAA,KAAA,EAAAU,EAAAX,KAAA,EAAAW,EAAAL,GAAAK,EAAA,MAAA,GAsBQV,EAAIU,EAAAL,IAtBZ,KAAA,EAAA,IAAA,MAAA,OAAAK,EAAAF,SAAA,KAAAG,KAAA,CAAA,CAAA,EAAA,OAAAC,OAAAC,QAAAjC,SAAAkC,MAAA,MAAA/B","file":"OTP.min.js","sourcesContent":["const mongoose = require(\"mongoose\");\nconst mailSender = require('../utils/mailSender');\n\nconst OTPSchema = new mongoose.Schema({\n    email: {\n        type: String,\n        required: true,\n    },\n    otp: {\n        type: String,\n        required: true,\n    },\n    createdAt: {\n        type: Date,\n        default: Date.now,\n        expires: 5 * 60, // Document will be automatically deleted after 5 minutes\n    }\n});\n\n// Function to send verification email\nasync function sendVerificationEmail(email, otp) {\n    try {\n        const mailResponse = await mailSender(\n            email,\n            \"Verification Email from StudyNotion\",\n            `<h1>Please verify your email</h1>\n            <p>Your OTP for verification is: ${otp}</p>\n            <p>This OTP is valid for 5 minutes</p>`\n        );\n        return mailResponse;\n    } catch (error) {\n        console.log(\"Error occurred while sending verification email:\", error);\n        throw error;\n    }\n}\n\n// Pre-save middleware to send OTP email\nOTPSchema.pre(\"save\", async function(next) {\n    try {\n        await sendVerificationEmail(this.email, this.otp);\n        next();\n    } catch (error) {\n        next(error);\n    }\n});\n\nmodule.exports = mongoose.model(\"OTP\", OTPSchema);"]}